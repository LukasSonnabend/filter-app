# Pluralisierung/Beugung finden
# Eigentlich suchen wir nur nach Substantiven?
def week(date)
  stopwords = %w[
    die der und das für den auf eine von mit ist ein sie sich zum auch dem als
    mehr nicht des wie bei sind aus einer werden hat wird oder über zur vor einen
    einem nach nur dass unternehmen kann hier durch können diese aber noch haben
    wenn was ihre sein unter wir thema mitarbeiter man bis dann dabei geht alle
    damit eines immer keine ihrer dieser sondern gibt doch muss viele diesem ganz
    also dies müssen ihr schon selbst arbeit anderen vom zwei weitere beim neue
    ihren finden wieder wer nun ich denn viel welche zeit dieses gilt ihnen ohne
    machen sollten zwischen bild bereits dazu lassen arbeitgeber sowie jahr seit
    sehr jahren stehen wurde dafür andere kommt jedoch uns heute zeigt neuen oft
    erst sollte eigenen gut frage arbeiten prozent fragen wurden arbeitnehmer
    allem steht etwas amp besonders weil mal war beispiel allerdings soll zwar
    diesen unsere macht drei kommen will waren ersten rund autor gerade eigene
    lässt einmal anzeige ihrem sogar fall weiter jeder denen einfach seine
    stellen menschen daher besser schnell jetzt wollen kein drucken davon stelle
    erstellt gar liegt vielen weg studie solche seiner könnte geändert
    mitarbeitern neben seinen besten genau deren informationen
    www informationen the darauf gute regel habe allen blick warum natürlich
    kollegen zeigen große stellt ins darüber wichtig sei etwa tun bleiben einige
    deutschen beispielsweise unternehmens geben gehen letzten wissen wenig
    gegenüber jahre großen während dort blog aller eher zudem klar hatte nutzen
    tipps weniger sehen bzw nächsten vielleicht bieten download zunächst seinem
    führen ihm ihn net bereich alles meist aktuelle nehmen entwicklung gleich
    deshalb verfügung aktuellen führung möglichkeit artikel themen kaum fünf
    häufig insbesondere ebenfalls sieht panthermedia wirklich ende heißt
    grundsätzlich tatsächlich deutlich rolle außerdem ebenso eur quelle beiden
    recht grund erhalten dagegen darf halten sagen meisten laut anspruch würde
    ergebnisse mir dennoch hatten insgesamt verschiedene seite Änderung herr
    statt handelt möglich letzte lesen wichtige art direkt keinen teil liegen
    regelmäßig nichts business bitte erreichen wäre erste zurück anderem erreicht
    findet sollen bleibt and derzeit gegen eigentlich gleichzeitig zumindest
    setzen gründe guten nimmt zusammenarbeit befragten fast wolff folgenden bin
    kurz mich entwickeln jedem bringen geschäftsführer team schließlich ihres
    denken zusammen ziel achten wegen wohl eben gerne überhaupt darin vergleich
    sowohl welchen beruflichen vier oben deutsche produkte meinen gemeinsam
    erfolgreich suchen aufgrund weiteren leser zweite
    lernen richtig hohe gemacht innerhalb anders rahmen besteht sprechen
    möglichkeiten würden interesse teilen folgen kosten herausforderungen
    situation position per wichtiger meine aufgabe beitrag schaffen shutterstock
    führt bedeutung hilft neu erkennen personen dadurch bekommen beschäftigt
    zahlen erfolg hin darum bringt chef unser maßnahmen millionen bedeutet
    durchaus sorgen social leider ziele stark bietet basis digitalen Über paar
    beide nie aktiv möchten danach manager tag helfen entsprechend welt brauchen
    daten gehört kennen schwer stärken leben entstehen platz folgende form online
    jeden leicht aktuell entscheiden erfahrungen universität aufgaben for
    entscheidung gehören woche spielen gmbh könnten möchte setzt zahlreiche
    mehrere hätte möglichst
    offen sicht anfang erfahrung einsatz verhalten suche bestehen schritt weit
    news frauen treffen berlin unterschiedlichen dürfen gewinnen desto dinge
    lösungen solchen change jeweils trotz persönliche beruf unbedingt com fest
    nämlich wirkt ergebnis umsetzung neues später fehler interessant richtigen
    einzelnen wirtschaft zehn allein lange eindruck schreiben unserer werte
    selten ändern problem digitale stärker ständig seiten lediglich leisten
    projekte
    sharesharesharepin itsharemail jedes sagt somit verschiedenen daraus all
    vermeiden wann beschäftigen sicher hand positiv hilfe weise hinaus sache
    entwickelt januar folgt hören somit kleine konnte meiner vermutlich nennen
    scheint februar märz april mai juni juli august september oktober november
    dezember ort
    anforderungen bewerber meinung führungskräften ideen gab lösung weiterhin
    jobs unseren fällt praxis bewusst euro stand neuer wichtigsten personal jede
    erfahren veränderungen daran person hinter kandidaten antworten hoch
    zunehmend chance bereichen knapp auswirkungen
    media persönlichen bisher employer mein einigen sinn unserem sofort
    unterstützt weiß teams ganze partner braucht markt pro organisation wert
    verstehen gespräch feedback new beiträge funktioniert entscheidungen fokus
    prozess sonst sinne teilnehmer fällen marketing kleinen leistung zeiten
    mittlerweile unterstützen wochen frau mindestens dessen experten mensch
    ausbildung branchen jahres interview gestellt ermöglichen welches konkrete
    anderer tage groß passt system zusätzlich google sinnvoll idee probleme
    sechs manche richtige sozialen herausforderung entwicklungen bestimmten
    schneller erwarten hält veränderung leistungen beispiele wenige vertrauen
    bereit erklärt stunden persönlich bekannt vielmehr wege veröffentlicht
    chancen antwort ziehen freuen kam anhand konkret e-mail gefragt bevor
    gesellschaft trends wandel jeweiligen tätigkeit konnten kontakt umgang
    gestalten zahl
    kunden qualität hohen völlig karriere ermöglicht vergangenen zuvor Überblick
    trotzdem bestimmte dank teilweise zusammenhang unterstützung heraus digital
    hälfte beschäftigten worden durchgeführt zweiten kompetenzen junge gleichen
    reicht verändern entschieden manchmal buch fähigkeiten spielt uhr ausreichend
    gelten erster genug prozesse obwohl monaten sicherheit data inhalte umfeld
    bekommt seien bezug größten beste versuchen welcher punkt gutes unabhängig
    fazit weder firma verbunden miteinander fehlt verändert entsprechende
    hintergrund umfrage dar besondere hierbei erleben branche verbessern werde
    firmen
    nachdem indem nein gruppe wiederum raum lage jemand früher hingegen gründen
    top folge länger unterschiedliche bewerten gehalt meinem vorteil positive
    erfolgreiche zuletzt genutzt methoden wünschen legen anzahl tools klare
    gesagt studien gegeben konkreten beginn passenden entsprechenden mag weltweit
    gefühl spaß übrigens erhöhen einfluss steigt genommen gelingt ging guter
    stets angebot inzwischen höher medien regeln projekt zentrale monate gefunden
    automatisch zielgruppe gedanken lieber größte ländern drittel nächste beginnt
    arbeitnehmern minuten verlassen fehlen acht experience berücksichtigt
    entscheidend beschäftigung information gestaltung analyse soziale
    erfolgreichen spricht glauben büro grenzen gesucht her liefert gefahr
    entweder bedarf gesamte bewerbern konzept kennt sicherlich berufliche begriff
    arbeitet bewerbung fühlen lohnt ausschließlich häufiger informieren mittel
    bessere egal betrieb grundlage großer hängt erfüllen anbieter nutzung
    privaten entsteht sucht voraussetzung etc hierfür fallen längst talent
    gezielt letztlich voraussetzungen organisationen
    damals rein einiges unterschiede behalten übernehmen
    immerhin klassischen mehrheit lang gewisse notwendig linie
    wären offene generell richtet vertreten not
    frei verantwortung wichtigen abschluss geworden genauso morgen punkte tätig
    individuelle anderes fördern strategie profitieren kommenden künftig
    situationen schön augen münchen website arbeitgebers human handeln vorteile
    köln außerhalb reagieren tragen usa bilden wahl zählen sieben kinder
    recruiter hinzu urteil solcher kommunizieren hinsichtlich lautet trägt
    informiert oftmals namen potenzial reihe schlecht kurzen interessieren umso
    bislang work faktoren höhere hätten erhält erfüllt komplett mitarbeiters
    läuft erklären verantwortlich trifft passen risiko alleine zeitpunkt start
    berater angebote fähigkeit innovation zählt vorher einstellung zuerst
    interessen tut ganzen richtung produkt dauer überall kurze laufen überzeugt
    gesehen austausch beginnen wunsch beachten services anwendung beteiligten
    betrifft vorstellen auswahl
  ]

  collocations = {
    /social[ -]?media|soziale medien/i => 'SocialMedia',
    /employer[ -]?brand(ing)?/i => 'EmployerBranding',
    /new[ -]?work/i => 'NewWork',
    /big[ -]?data/i => 'BigData',
    /candidate[ -]?experience|Bewerbererfahrung|Kandidatenerfahrung/i => 'CandidateExperience'
  }

  ignore_now = %w[
    deutschland recruiting zukunft digitalisierung job kommunikation
    führungskräfte management arbeitswelt personaler facebook arbeitsplatz
    internet geld unternehmenskultur branding motivation weiterbildung
    stellenanzeigen alter arbeitszeit generation engagement angst familie
    mobile software beratung socialmedia employerbranding führungskraft
    kündigung linkedin twitter leadership kultur gründer transformation
    arbeitsmarkt kriterien technologien
  ]

  stopwords += ignore_now

  regex = /[^\p{word}-]/
  news_this_day = NewsItem.where(created_at: date.to_time.all_week)
  texts = news_this_day.map { |i| [i.source_id, i.plaintext] }.group_by { |a, _| a }.map { |_, b| b.join ' ' }
  words = texts.map { |text|
    collocations.each do |from, to|
      text.gsub! from, to
    end
    text.split(regex).
      map(&:downcase).
      reject { |i| i.length < 3 || i[/^\d/] || stopwords.include?(i) }.uniq
  }.flatten
  most = words.group_by(&:itself).map { |a, b| [a, b.count] }.select { |_, b| b > 3 }.sort_by { |_, b| -b }.take(50)
  w = most.map(&:first).join(' ')
  puts "#{date}: #{w}"
  w
end

base = NewsItem.maximum(:created_at).to_date
dates = 20.times.map { |i| base - 7 * i }
$a = dates.map { |date| week(date) }

$a.join(' ').split(' ').group_by(&:itself).map{|a,b| [a,b.count]}.select{|a,b| b > 1 }.sort_by{|a,b| -b}.map(&:first)
